<html>
  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">    
    
    <style>
      /* put your css styles here...*/
      .col-sm {
        padding: 3px;
        height: 150px;
      }

      .btn-treasure {
        width: 100%;
        height: 100%;
        border-radius: 0px;
      }

      .hidden {background-color: black;}
      .revealed {background-color: red;}
      .treasure {background-color: green;}
    </style>
  </head>
  
  <body>
    <div class="container">
      <!--put your html code here...-->
      <h4>Treasure Hunt</h4>
      <div id="gameBoard"></div>
      <h3 id="guesses"></h3>
      <p id="error"></p>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>    
    
    <!--put your modal dialogs here...-->
    <div class="modal fade" id="modalPlayAgain" tabindex="-1" role="dialog" aria-labelledby="modalPlayAgainLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalPlayAgainLabel">Play Again?</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            Would you like to play again?
          </div>
          <div class="modal-footer">
            <button id="modalPlayAgainRestartButton" type="button" class="btn btn-primary" data-dismiss="modal">Yes</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
          </div>
        </div>
      </div>
    </div>



    <script>
    /* global $ */
    // put your JavaScript code here...
    $(document).ready(function() 
    {
      
      // Variables
      let model = {};

      function initializeModel() {
        model.error = "";
        model.result = {};
      }


      // view...
      function updateView() {
        if (model.error != "") { $("#error").text(model.error); }
        else {renderBoard();}
      }

      //Render the game board
      function renderBoard() {
        let board = model.result.board;
        let size = board.length;
        let fullRows = Math.floor(size / 2);
        let partRows = (size % 2 !== 0);

        $("#gameBoard").empty();
        $("#guesses").text("Guesses: " + model.result.guesses);

        //Create the full rows
        for(let i = 0; i < fullRows; i++) {
          let row = $('<div class="row"></div>');
          
          //Add both buttons
          for(let b = 0; b < 2; b++) {
            let index = (i*2) + b;
            let target = board[index];
            let cls = (target.uncovered ? (target.treasure ? "treasure" : "revealed") : "hidden");

            row.append(`
              <div class="col-sm">
                <div class="btn-treasure ${cls}" id="treasure-${index}">
                  &nbsp;
                </div>
              </div>`
            );
          }
          $("#gameBoard").append(row);
        }

        //Create the partial rows
        if (partRows) {
          let row = $('<div class="row"></div>');
          let index = size-1;
          let target = board[index];
          let cls = (target.uncovered ? (target.treasure ? "treasure" : "revealed") : "hidden");
          row.append(`
            <div class="col-sm">
              <div class="btn-treasure ${cls}" id="treasure-${index}">
                &nbsp;
              </div>
            </div>`
          );
          //row.append(`<div class="col-sm"><button type="button" class="btn btn-primary btn-treasure" id="treasure-${size-1}">&nbsp;${size-1}</button></div>`);
          row.append('<div class="col-sm"></div>');
          $("#gameBoard").append(row);
        }

        //Add the function to the buttons
        //This will not be applied to uncovered elements to prevent unneeded calls
        //This will not trigger if the game is in a COMPLETE state
        if (model.result.state != "COMPLETE") {
          for(let i = 0; i < size; i++) {
            $("#treasure-" + i + ".hidden").click(function() {
                let url = 'game?guess='+i;
                sendRequest(url);
            });
          }
        }

        else {
          
          $('#modalPlayAgain').modal({focus: true});
          $('#modalPlayAgainRestartButton').click(function(){
            sendRequest('game?restart=true');
          });
        }
      }

      //Sends an ajax request
      function sendRequest(url) {
        let jqxhr = $.get(url);
        
        jqxhr.done(function(json)  {
            model.result = {};

            if (json.error !== undefined) { model.error = json.error; }
            else { model.result = json.result; }

            updateView();
        });
        
        jqxhr.fail(function(json)  {
            let error = JSON.stringify(json);
            model.error = error;
            updateView();
        });
      }
      
      // run...
      initializeModel();
      let url = 'game';
      sendRequest(url);
    });    
      
    </script>
  </body>

</html>